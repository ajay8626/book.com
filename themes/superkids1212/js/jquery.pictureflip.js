(function($,w,d,undefined){var Modernizr=w.Modernizr;$.pageFlip=function(options,element){$this=this;this.element=element;this.$element=$(element);this.init(options);}
$.pageFlip.defaults={time:1,shadow:true,slideTime:0.2,autoRun:false,autoTime:5}
$.pageFlip.prototype={init:function(options){this.options=$.extend(true,{},$.pageFlip.defaults,options);this.animated=false;if(!Modernizr.csstransforms3d){this.options.time=0;this.options.slideTime=0;}this.append();this.pagination(true);if(this.options.autoRun===true){this.auto();}},append:function(){this.$element.append('<div class="prev">Previous Page</div><div class="next">Next Page</div><div class="prev prev_b"><span></span><div>Previous</div></div><div class="next next_b"><span></span><div>Next</div></div>');this.$element.find('.content').css({'transition':'all '+$this.options.slideTime+'s linear'});$('.slide').height($this.$element.height()-40)
$('.slide:first').addClass('current');$('.slide:first .content').addClass('slideup');if(Modernizr.csstransforms3d){this.$element.find('.slide').each(function(){$(this).append('<div class="img"></div><div class="img"></div>');var image=$(this).find('img').css('display','none').attr('src');$(this).find('.img').css({'background':'url("'+image+'")','transition-duration':($this.options.time/2)+'s, '+($this.options.time/2)+'s'});$(this).find('.img:last-of-type').css({'right':'0','left':'auto','background-position':'100% 0'});});}},events:function(){function nextClick(quick){if(quick===false)var ntime=$this.options.time*1000,stime=$this.options.slideTime*1000;else var ntime=$this.options.time,stime=$this.options.slideTime;if($this.animated===false){$('.slide:first .content').removeClass('slideup');$this.animated=true;if(quick===false){var current=$('.current .img:last-of-type',$this.$element);var next=$('.current',$this.$element).nextAll('.slide:first').find('.img:first');$('.slide .img').css({'transition-duration':($this.options.time/2)+'s'});next.css({'opacity':'0','transform':'rotateY(90deg)','transform-origin':'100% 100%',});if($this.options.shadow===true){next.css({'box-shadow':'inset 0 0 2000px 5000px rgba(0,0,0,0.3)'});current.css({'box-shadow':'inset 0 0 2000px 5000px rgba(0,0,0,0.3)'});}setTimeout(function(){$('.current').nextAll('.slide:first').css('z-index','999');current.css({'transform':'rotateY(-90deg)',});},stime);setTimeout(function(){next.css({'opacity':'1','transform':'rotateY(0deg)','box-shadow':'none'});$('.current').nextAll('.slide:first').css({'z-index':'999999'});},ntime/2+stime);}setTimeout(function(){$('.current').nextAll('.slide:first').addClass('current').css({'z-index':''}).siblings().removeClass('current');$('.slide > .img:first').css({'transform':'none','left':'0','right':'0','box-shadow':'none'});$('.slide > .img:last').css({'transform':'none','transition-duration':'0','box-shadow':'none'});$('.slide:first',$this.$element).appendTo($this.$element);$this.animated=false;$this.pagination(false);if(quick===false){$('.slide:first .content').addClass('slideup');}},ntime+stime);}}function prevClick(quick){if(quick===false)var ntime=$this.options.time*1000,stime=$this.options.slideTime*1000;else var ntime=$this.options.time,stime=$this.options.slideTime;if($this.animated===false){$this.animated=true;$('.slide:first .content').removeClass('slideup');if(quick===false){var current=$('.current .img:first',$this.$element);var prev=$('.current',$this.$element).nextAll('.slide:last').find('.img:last');$('.slide .img').css({'transition-duration':($this.options.time/2)+'s'});setTimeout(function(){prev.css({'opacity':'0','transform':'rotateY(90deg)','transform-origin':'0 0','box-shadow':'inset 0 0 2000px 5000px rgba(0,0,0,0.3)'});current.css({'transform':'rotateY(90deg)','transform-origin':'100% 100%','box-shadow':'inset 0 0 2000px 5000px rgba(0,0,0,0.3)'});if($this.options.shadow===true){prev.css({'box-shadow':'inset 0 0 2000px 5000px rgba(0,0,0,0.3)'});current.css({'box-shadow':'inset 0 0 2000px 5000px rgba(0,0,0,0.3)'});}},stime);setTimeout(function(){prev.css({'opacity':'1','transform':'rotateY(0)','box-shadow':'none'});$('.slide:last').css({'z-index':'999999'});},ntime/2+stime)}setTimeout(function(){$('.slide:last').addClass('current').css({'z-index':''}).siblings().removeClass('current');$('.slide > .img:first').css({'transform':'none','left':'0','right':'0','transition-duration':'0','box-shadow':'none'});$('.slide > .img:last').css({'transform':'none','box-shadow':'none'});$('.slide:last',$this.$element).prependTo($this.$element);$this.animated=false;$this.pagination(false);},ntime+stime);setTimeout(function(){if(quick===false){$('.slide:first .content').addClass('slideup');}},ntime+stime+1);}}$('.next',$this.$element).on("click",function(){nextClick(false)});$('.prev',$this.$element).on("click",function(){prevClick(false)});$('#pagination div',$this.$element).on("click",function(){var slideid=$(this).attr('class').split(' ')[0].split('-')[1],curid=$('#pagination .cur').attr('class').split(' ')[0].split('-')[1],diff=slideid-curid,clicker=nextClick;if(diff<0){clicker=prevClick;}var i=0,prun;var prun=setInterval(function(){diff=Math.abs(diff);if(diff!=0&&i<diff){clicker(true);}if(i===diff||diff===0){clearInterval(prun);$('.slide:first .content').addClass('slideup');}++i;},(($this.options.time*10))+($this.options.slideTime*10));});},pagination:function(append){var i=0,classid;if(append===true){$(this.element).append('<div id="pagination"></div>');this.$element.find('.slide').each(function(){$(this).addClass('s-'+i);$('#pagination').append('<div class="p-'+i+'"></div>');++i;});classid=$('.current').attr('class').split(' ')[2].split('-')[1];this.events();}else{classid=$('.current').attr('class').split(' ')[1].split('-')[1];}$('#pagination div').each(function(){var pageid=$(this).attr('class').split('-')[1];if(pageid===classid){$(this).addClass('cur');}else{$(this).removeClass('cur');}})},auto:function(){var autoslide,hovering=false;$this.$element.on("mouseover",function(){hovering=true;clearInterval(autoslide);});$this.$element.on("mouseout",function(){hovering=false;});$(w).on("hover",function(){clearInterval(autoslide);if(hovering===false){autoslide=setInterval(function(){$this.$element.find('.next').click();},($this.options.autoTime*1000));}});}}
$.fn.pageFlip=function(options,content){return this.each(function(){new $.pageFlip(options,this);});};})(jQuery,window,document);